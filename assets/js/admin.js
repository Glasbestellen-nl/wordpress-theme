jQuery(document).ready((function(t){function e(e){const n=t(".js-lead-form").serialize()+"&action=update_lead";t.post(gb.ajaxUrl,n,(function(t){e()}))}t(window).on("load",(function(){function e(){const e=".js-someone-editing",n=[];t(e).each((function(e,i){n.push(t(i).data("lead-id"))}));const i={action:"check_leads_current_editor",lead_ids:n};t.get(ajaxurl,i,(function(n){if(n)for(const[i,a]of Object.entries(n))a?t(e+"-"+i).fadeIn():t(e+"-"+i).fadeOut()}))}if(null==window.location.search)return;const n=new URLSearchParams(window.location.search);if("crm"==n.get("page")){const i=n.get("lead_id");if(i){const e={action:"update_lead_current_editor",lead_id:i};t.post(ajaxurl,e,(function(e){e.other_editor&&t(".js-current-editor-notice").show()}))}else e(),setInterval(e,5e3)}})).unload((function(){const t=new URLSearchParams(window.location.search);if("crm"==t.get("page")){const e=t.get("lead_id");if(e){const t=new FormData;t.append("action","unset_lead_current_editor"),t.append("lead_id",e),navigator.sendBeacon(ajaxurl,t)}}})),t(".js-lead-row-delete-link").click((function(){return confirm(gb.msg.sureDeleteLead)})),function(){const e=t(".js-conversion-tracking-dashboard");t(e).on("click",".js-add-item-button",(function(n){n.preventDefault(),t.get(gb.ajaxUrl,{action:"get_dashboard_item_row_html"},(function(n){t(".js-items-table tbody",e).append(n)}))})).on("click",".js-submit-button",(function(n){n.preventDefault(),t(this);let i=t('[name="lead_id"]').val(),a=t(":input",e).serialize()+"&action=save_dasboard_conversion&lead_id="+i;t.post(gb.ajaxUrl,a,(function(t){}))})).on("click",".js-delete-item-button",(function(e){e.preventDefault(),t(this).parents("tr").remove()}))}(),t(".js-change-update-lead").change(e),t(".js-blur-update-lead").blur(e),t(".js-delete-lead").click((function(e){if(e.preventDefault(),confirm(gb.msg.sureDeleteLead)){let e={action:"delete_lead",lead_id:t('[name="lead_id"]').val()};t.post(gb.ajaxUrl,e,(function(t){window.location.replace(t)}))}})),t(".js-conversion-tracking-settings").on("click",".js-add-item-button",(function(t){t.preventDefault()})),t(".js-toggle-target").on("click",(function(e){e.preventDefault();let n=t(this).data("toggle-target");t(n).slideToggle()})),t((function(){var e=!0;t("textarea.js-tab-support").keydown((function(n){if(27==n.keyCode)return e=!e,!1;if(13===n.keyCode&&e&&this.selectionStart==this.selectionEnd){for(var i=this.selectionStart,a=t(this).val();i>0&&"\n"!=a[i-1];)i--;for(var o=i;" "==a[i]||"\t"==a[i];)i++;if(i>o)return document.execCommand("insertText",!1,"\n"+a.substr(o,i-o)),this.blur(),this.focus(),!1}if(9===n.keyCode&&e){if(this.selectionStart==this.selectionEnd)n.shiftKey?(a=this.value,this.selectionStart>0&&"\t"==a[this.selectionStart-1]&&document.execCommand("delete")):document.execCommand("insertText",!1,"\t");else{var s=this.selectionStart,r=this.selectionEnd;for(a=t(this).val();s>0&&"\n"!=a[s-1];)s--;for(;r>0&&"\n"!=a[r-1]&&r<a.length;)r++;for(var c=a.substr(s,r-s).split("\n"),l=0;l<c.length;l++)l==c.length-1&&0==c[l].length||(n.shiftKey?c[l].startsWith("\t")?c[l]=c[l].substr(1):c[l].startsWith("    ")&&(c[l]=c[l].substr(4)):c[l]="\t"+c[l]);c=c.join("\n"),this.value=a.substr(0,s)+c+a.substr(r),this.selectionStart=s,this.selectionEnd=s+c.length}return!1}return e=!0,!0}))}))}));