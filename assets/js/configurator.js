"use strict";var Configurator=function(){function a(a){var b=jQuery;this.element=a,this.init=function(){var a=this;this.element.addEventListener("click",function(b){if(b.target&&b.target.closest(".js-choice")){var c=b.target.closest(".js-choice"),d=c.dataset.choiceValue;a.selectChoice(c),a.updateChoiceEnlargement(d)}if(b.target&&b.target.closest(".js-v-step")){var e=b.target.closest(".js-v-step"),f=e.dataset.stepId,g=e.dataset.stepTitle,h=a;a.showStep(f,g,function(){var a=h.element.querySelector(".js-configurator-step-choice");if(null!==a){var b=a.value;h.updateChoiceEnlargement(b)}})}b.target&&b.target.closest(".js-configurator-to-cart")&&a.toCart()}),this.element.addEventListener("submit",function(b){if(b.target&&b.target.matches(".js-configurator-step-form")){b.preventDefault();var c=b.target;a.submitStep(c)}}),this.element.addEventListener("keyup",function(b){b.target&&b.target.matches(".js-form-validate")&&a.validateInput(b.target)});var c=this;b(this.element).on("change",".js-configurator-blur-update .js-form-validate",function(){var a=b(this).data("step-id"),d=b("option:selected",this).data("child-step");d?b(".js-step-"+d).removeClass("d-none"):b(".js-step-parent-"+a).addClass("d-none");var e=b(this).parents(".js-configurator-blur-update");if(e){var f=new FormData(e[0]);f.append("action","handle_configurator_form_submit"),f.append("configurator_id",gb.configuratorId),b(":input",e).each(function(a,d){b(d).val()&&c.validateInput(d)}),b.ajax({url:gb.ajaxUrl,type:"POST",data:f,processData:!1,contentType:!1,context:c,success:function success(){this.updateTotalPrice()}})}}).on("click",".js-configurator-cart-button",function(a){a.preventDefault();var d=b(this).parents("form"),e=!0,f=[];if(b(":input",d).each(function(a,b){c.validateInput(b)||(e=!1,f.push(b))}),e){var g=b(".js-configurator-quantity").val()||1,h=b(".js-configurator-message").val()||"";c.toCart(g,h)}else{var i=b(f[0]);i.isInViewport()||i.scrollTo(-200)}})},this.selectChoice=function(a){var b=a.dataset.choiceValue;a.classList.add("current");var c=a.closest(".js-choices").querySelectorAll(".js-choice");null!==c&&c.forEach(function(b){b!==a&&b.classList.remove("current")});var d=a.closest("form").querySelector(".js-configurator-step-choice");null!==d&&(d.value=b)},this.updateChoiceEnlargement=function(a){var c=this.element.querySelector(".js-choice-enlargement");if(null!==c){b.get(gb.ajaxUrl,{action:"get_configurator_choice_enlargement_html",part_id:a},function(a){c.innerHTML=a})}},this.showStep=function(a,c,d){showModal(c,"large");var e={action:"get_configurator_step_html",configurator_id:gb.configuratorId,step_id:a};b.get(gb.ajaxUrl,e,function(b){loadModalContent(b),d(a)})},this.updateSteps=function(){var a=this.element.querySelector(".js-v-steps"),c={action:"get_configurator_steps_html",configurator_id:gb.configuratorId};b.get(gb.ajaxUrl,c,function(b){a.innerHTML=b})},this.updateTotalPrice=function(){var a=this.element.querySelector(".js-config-total-price"),c={action:"get_configurator_total_price",configurator_id:gb.configuratorId};b.get(gb.ajaxUrl,c,function(b){a.innerHTML=b})},this.submitStep=function(a){var c=this,d=!0,e=a.querySelectorAll(".js-form-validate");if(null!==e&&e.forEach(function(a){c.validateInput(a)||(d=!1)}),d){var f=new FormData(a),g=a.querySelector(".js-form-action").value;f.append("action",g),b.ajax({url:gb.ajaxUrl,type:"POST",data:f,processData:!1,contentType:!1,context:this,success:function success(){hideModal(),this.updateSteps(),this.updateTotalPrice()}})}},this.toCart=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,c=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"",d={action:"handle_configurator_to_cart",configurator_id:gb.configuratorId,quantity:a,message:c};b.post(gb.ajaxUrl,d,function(a){a&&window.location.replace(a)})},this.validateInput=function(a){clearValidate(a);var c=!0,d=gb.msg.enterField,e=!0,f=a.value,g=a.dataset.required,h=b(a).data("validation-rules");if(f?h&&(void 0!==h.min&&f<parseInt(h.min)&&(c=!1,d=gb.msg.dimensionValueTooSmall.replace("{0}",h.min)),void 0!==h.max&&f>parseInt(h.max)&&(c=!1,d=gb.msg.dimensionValueTooLarge.replace("{0}",h.max))):g?c=!1:e=!1,b(a).is("select")){var i=b("option:selected",a),j=i.data("validation-rules");if(j&&void 0!==j.exclude){var m=j.exclude;if(m.step&&m.option){var k=b(".js-step-input-".concat(m.step)),l=k.find("option[data-option-id=\"".concat(m.option,"\"]:selected"));0<l.length&&(c=!1,d=m.message)}}}return e&&(c?isValid(a):isInvalid(a,d)),c}}function b(b){return c=new a(b),c}var c;return{getInstance:function getInstance(a){return c||(c=b(a)),c}}}(),configurator=Configurator.getInstance(document.querySelector(".js-configurator"));configurator.init();