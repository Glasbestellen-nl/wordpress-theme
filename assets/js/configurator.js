"use strict";var Configurator=function(){function a(a){this.element=a,this.init=function(){var a=this;this.element.addEventListener("click",function(b){if(b.target&&b.target.closest(".js-choice")){var c=b.target.closest(".js-choice"),d=c.dataset.choiceValue;a.selectChoice(c),a.updateChoiceEnlargement(d)}if(b.target&&b.target.closest(".js-v-step")){var e=b.target.closest(".js-v-step"),f=e.dataset.stepId,g=e.dataset.stepTitle,h=a;a.showStep(f,g,function(){var a=h.element.querySelector(".js-configurator-step-choice");if(null!==a){var b=a.value;h.updateChoiceEnlargement(b)}})}b.target&&b.target.closest(".js-configurator-to-cart")&&a.toCart()}),this.element.addEventListener("submit",function(b){if(b.target&&b.target.matches(".js-configurator-step-form")){b.preventDefault();var c=b.target;a.submitStep(c)}}),this.element.addEventListener("keyup",function(b){b.target&&b.target.matches(".js-form-validate")&&a.validateInput(b.target)});var b=this;jQuery(this.element).on("change",".js-configurator-blur-update .js-form-validate",function(){var a=jQuery(this).parents(".js-configurator-blur-update");if(a){var c=new FormData(a[0]);c.append("action","handle_configurator_form_submit"),c.append("configurator_id",gb.configuratorId),jQuery(":input",a).each(function(a,c){jQuery(c).val()&&b.validateInput(c)}),jQuery.ajax({url:gb.ajaxUrl,type:"POST",data:c,processData:!1,contentType:!1,context:b,success:function success(a){console.log(a),this.updateTotalPrice()}})}}).on("click",".js-configurator-cart-button",function(a){a.preventDefault();var c=jQuery(this).parents("form"),d=!0,e=[];if(jQuery(":input",c).each(function(a,c){b.validateInput(c)||(d=!1,e.push(c))}),d){var f=jQuery(".js-configurator-quantity").val()||1,g=jQuery(".js-configurator-message").val()||"";b.toCart(f,g)}else{var h=jQuery(e[0]);h.isInViewport()||h.scrollTo(-200)}})},this.selectChoice=function(a){var b=a.dataset.choiceValue;a.classList.add("current");var c=a.closest(".js-choices").querySelectorAll(".js-choice");null!==c&&c.forEach(function(b){b!==a&&b.classList.remove("current")});var d=a.closest("form").querySelector(".js-configurator-step-choice");null!==d&&(d.value=b)},this.updateChoiceEnlargement=function(a){var b=this.element.querySelector(".js-choice-enlargement");if(null!==b){jQuery.get(gb.ajaxUrl,{action:"get_configurator_choice_enlargement_html",part_id:a},function(a){b.innerHTML=a})}},this.showStep=function(a,b,c){showModal(b,"large");var d={action:"get_configurator_step_html",configurator_id:gb.configuratorId,step_id:a};jQuery.get(gb.ajaxUrl,d,function(b){loadModalContent(b),c(a)})},this.updateSteps=function(){var a=this.element.querySelector(".js-v-steps"),b={action:"get_configurator_steps_html",configurator_id:gb.configuratorId};jQuery.get(gb.ajaxUrl,b,function(b){a.innerHTML=b})},this.updateTotalPrice=function(){var a=this.element.querySelector(".js-config-total-price"),b={action:"get_configurator_total_price",configurator_id:gb.configuratorId};jQuery.get(gb.ajaxUrl,b,function(b){a.innerHTML=b})},this.submitStep=function(a){var b=this,c=!0,d=a.querySelectorAll(".js-form-validate");if(null!==d&&d.forEach(function(a){b.validateInput(a)||(c=!1)}),c){var e=new FormData(a),f=a.querySelector(".js-form-action").value;e.append("action",f),jQuery.ajax({url:gb.ajaxUrl,type:"POST",data:e,processData:!1,contentType:!1,context:this,success:function success(){hideModal(),this.updateSteps(),this.updateTotalPrice()}})}},this.toCart=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1,b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"",c={action:"handle_configurator_to_cart",configurator_id:gb.configuratorId,quantity:a,message:b};jQuery.post(gb.ajaxUrl,c,function(a){a&&window.location.replace(a)})},this.validateInput=function(a){clearValidate(a);var b=!0,c=gb.msg.enterField,d=!0,e=a.value,f=a.dataset.required,g=jQuery(a).data("validation-rules");if(e?g&&(void 0!==g.min&&e<parseInt(g.min)&&(b=!1,c=gb.msg.dimensionValueTooSmall.replace("{0}",g.min)),void 0!==g.max&&e>parseInt(g.max)&&(b=!1,c=gb.msg.dimensionValueTooLarge.replace("{0}",g.max))):f?b=!1:d=!1,jQuery(a).is("select")){var h=jQuery("option:selected",a),i=h.data("validation-rules");if(i&&void 0!==i.exclude){var l=i.exclude;if(l.step&&l.option){var j=jQuery(".js-step-".concat(l.step)),k=j.find("option[data-option-id=\"".concat(l.option,"\"]:selected"));0<k.length&&(b=!1,c=l.message)}}}return d&&(b?isValid(a):isInvalid(a,c)),b}}function b(b){return c=new a(b),c}var c;return{getInstance:function getInstance(a){return c||(c=b(a)),c}}}(),configurator=Configurator.getInstance(document.querySelector(".js-configurator"));configurator.init();